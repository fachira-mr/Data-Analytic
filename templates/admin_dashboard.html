<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
    
    .card {
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: none;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
    }
    
    .stat-card {
      background: #5DADE2;
      color: white;
      height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .stat-card:nth-child(2) { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .stat-card:nth-child(3) { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .stat-card:nth-child(4) { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    
    .sidebar {
      width: 220px;
      min-height: 100vh;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .btn { border-radius: 12px; }
    .btn-info { background-color: #4facfe; }
    .btn-info:hover { background-color: #006ccb; }
    .btn-danger:hover { background-color: #8d0013; }
    
    .chart-container { height: 350px; }
    .main-chart { height: 400px; }

    .welcome-section {
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .welcome-section:hover {
      border-color: #5DADE2;
      box-shadow: 0 4px 15px rgba(93, 173, 226, 0.15);
    }

    .welcome-text {
      color: #333;
      font-weight: 500;
      font-size: 1.1rem;
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -220px;
        z-index: 1040;
        transition: left 0.3s ease;
      }
      .sidebar.show { left: 0; }
      
      .sidebar-toggle {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1050;
        background: #4facfe;
        border: none;
        border-radius: 8px;
        padding: 10px;
        color: white;
      }
      
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1035;
        display: none;
      }
      .sidebar-overlay.show { display: block; }
      
      .main-content { padding: 70px 15px 15px 15px; }
      .chart-container { height: 300px; }
    }
  </style>
</head>
<body>
  <!-- Mobile Toggle -->
  <button class="sidebar-toggle d-md-none" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
  </button>
  
  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" onclick="closeSidebar()"></div>

  <div class="container-fluid p-0 p-md-5">
    <div class="d-flex">
      <!-- Sidebar -->
      <nav id="sidebar" class="sidebar p-3 d-flex flex-column">
        <!-- Logo -->
        <div class="text-center mb-4">
          <img src="{{ url_for('static', filename='images/logoDPRD.png') }}" alt="Logo" height="60" class="mb-2">
          <h4>Dashboard Admin</h4>
        </div>

        <!-- Menu -->
        <div class="flex-grow-1">
          <a href="{{ url_for('manage_users') }}" class="btn btn-info text-white w-100 mb-2">
            <i class="fas fa-users me-2"></i>Kelola Pengguna
          </a>
          <a href="{{ url_for('manage_uploads') }}" class="btn btn-outline-primary w-100 mb-2">
            <i class="fas fa-history me-2"></i>History
          </a>
        </div>

        <!-- Logout -->
        <a href="{{ url_for('logout') }}" class="btn btn-danger w-100">
          <i class="fas fa-sign-out-alt me-2"></i>Logout
        </a>
      </nav>

      <!-- Main Content -->
      <div class="main-content flex-grow-1 p-3 p-md-4">
        <!-- Welcome Section -->
        <div class="mb-4">
          <div class="welcome-section p-4 bg-white rounded shadow-sm text-center">
            <h4 class="welcome-text mb-0">
              <i class="fas fa-user-shield me-2"></i>
              Halo, <strong>{{ session['user'] if session.get('user') else 'Admin' }}</strong>!
              <br><small class="text-muted">Selamat datang di dashboard administrator</small>
            </h4>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="row g-3 mb-4">
          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <i class="fas fa-clipboard-list fa-2x mb-2"></i>
                <h6>Total Usulan</h6>
                <h2>{{ total_usulan }}</h2>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <i class="fas fa-map-marker-alt fa-2x mb-2"></i>
                <h6>Jumlah Kelurahan</h6>
                <h2>{{ total_kelurahan }}</h2>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <i class="fas fa-star fa-2x mb-2"></i>
                <h6>Kategori Terbanyak</h6>
                <h2>{{ kategori_terbanyak or "-" }}</h2>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                <h6>Tahun Data Terakhir</h6>
               <h2>{{ tahun_terakhir }}</h2>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="row g-4 mb-4">
          <!-- Pie Chart -->
          <div class="col-lg-5">
            <div class="card">
              <div class="card-body">
                <h5 class="mb-3">
                  <i class="fas fa-chart-pie me-2"></i>Distribusi Kategori
                </h5>
                <div class="chart-container">
                  <canvas id="kategoriChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bar Chart -->
          <div class="col-lg-7">
            <div class="card">
              <div class="card-body">
                <h5 class="mb-3">
                  <i class="fas fa-chart-bar me-2"></i>Distribusi Usulan per Kelurahan
                </h5>
                <div class="chart-container">
                  <canvas id="kelurahanChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Line Chart -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <h5 class="mb-3">
                  <i class="fas fa-chart-line me-2"></i>Tren Usulan per Tahun
                </h5>
                <div class="chart-container main-chart">
                  <canvas id="tahunChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Sidebar Toggle
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
      document.querySelector('.sidebar-overlay').classList.toggle('show');
    }
    
    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('show');
      document.querySelector('.sidebar-overlay').classList.remove('show');
    }

    // Charts
    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];

    // Pie Chart
    new Chart(document.getElementById('kategoriChart'), {
      type: 'doughnut',
      data: {
        labels: {{ kategori_labels|safe }},
        datasets: [{
          data: {{ kategori_counts|safe }},
          backgroundColor: colors,
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom' }
        },
        cutout: '60%'
      }
    });

    // Bar Chart
    new Chart(document.getElementById('kelurahanChart'), {
      type: 'bar',
      data: {
        labels: {{ kelurahan_labels|safe }},
        datasets: [{
          label: 'Jumlah Usulan',
          data: {{ kelurahan_counts|safe }},
          backgroundColor: '#4ECDC4',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        indexAxis: 'y',
        plugins: { legend: { display: false } },
        scales: {
          x: { beginAtZero: true },
          y: { grid: { display: false } }
        }
      }
    });

    // Line Chart
    new Chart(document.getElementById('tahunChart'), {
      type: 'line',
      data: {
        labels: {{ tahun_labels|safe }},
        datasets: [{
          label: 'Jumlah Usulan',
          data: {{ tahun_counts|safe }},
          borderColor: '#667eea',
          backgroundColor: 'rgba(102, 126, 234, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true },
          x: { grid: { color: 'rgba(0,0,0,0.1)' } }
        }
      }
    });
  </script>
</body>
</html>